<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:p="http://primefaces.org/ui">

<h:body onload="testValid()">
	<!--
	<script type="text/javascript">
		function testValid(){
			alert('Test valid');	
			if(#{not facesContext.validationFailed}) alert('Erreur');
		}
	</script>
	-->
	<ui:define name="metadata">
		<f:metadata>
        	<f:viewParam name="#{webConstantResources.requestParamStatut}" value="#{dossierListeController.statut}" converter="#{viewParamStatutConverter}"/> 
        	<f:viewParam name="#{webConstantResources.requestParamNextViewOutcome}" value="#{dossierListeController.nextViewOutcome}" />         
		    <f:event type="preRenderView" listener="#{dossierListeController.preRenderView}" />
    	</f:metadata>
	</ui:define>		
		
	<ui:composition template="/template/commun.xhtml">
		<ui:define name="contenu">
			<ui:decorate template="/template/formTemplate.xhtml">
				<ui:param name="uiController" value="#{dossierListeController}" />
				<ui:define name="contenu">	
					<p:fieldset legend="#{constantResources.text('criteresrecherche')}" rendered="false">
						<p:panelGrid columns="10" styleClass="panelGridNoBorder">
							<p:outputLabel for="dateDebut" value="#{constantResources.text('datedebut')}" />
							<p:calendar id="dateDebut" value="#{dossierListeController.dateDebut}" required="true" requiredMessage="#{valueRequiredMessage}"/>
							<p:message for="dateDebut" />
							
							<p:outputLabel for="dateFin" value="#{constantResources.text('datefin')}" />
							<p:calendar id="dateFin" value="#{dossierListeController.dateFin}" required="true" requiredMessage="#{valueRequiredMessage}"/>
							<p:message for="dateFin" />
							
							<p:outputLabel for="natureDep" value="#{constantResources.text('nature')}" />
							<p:selectOneMenu id="natureDep" value="#{dossierListeController.natureDeplacement}" required="true" requiredMessage="#{valueRequiredMessage}" converter="#{objectConverter}" >
								<f:selectItem noSelectionOption="" itemLabel="#{constantResources.text('tout')}"/>
								<f:selectItems value="#{natureDeplacements}" var="nd" itemLabel="#{nd.libelle}" />
							</p:selectOneMenu>
							<p:message for="natureDep" />
							
							<ui:include src="/resources/include/component/formCommand.xhtml" >
								<ui:param name="command" value="#{dossierListeController.rechercherCommande}" />
							</ui:include>
							
						</p:panelGrid>
					</p:fieldset>
					<p:separator/>
					
					<p:dataTable value="#{dossierListeController.list}" var="dossier" rowIndexVar="index">
						<p:column headerText="#"><h:outputText value="#{index+1}" /> </p:column>
						<p:column headerText="#{constantResources.text('numero')}"><h:outputText value="#{dossier.numero}" /></p:column>
						<p:column headerText="#{constantResources.text('datecreation')}">
							<h:outputText value="#{dossier.deplacement.dateCreation}"><f:convertDateTime pattern="#{constantResources.datePattern}"/></h:outputText>
						</p:column>
						<p:column headerText="#{constantResources.text('nature')}"><h:outputText value="#{dossier.deplacement.nature.libelle}" /></p:column>
						<p:column headerText="#{constantResources.text('matricule')}"><h:outputText value="#{dossier.beneficiaire.matricule}" /></p:column>
						<p:column headerText="#{constantResources.text('nomprenoms')}"><h:outputText value="#{dossier.beneficiaire.nomPrenoms}" /></p:column>
						<p:column headerText="#{constantResources.text('action')}">
							<p:commandButton value="#{constantResources.text('bouton.selectionner')}" action="#{dossierListeController.href(dossier)}"/>
						</p:column>
					</p:dataTable>
							
				</ui:define>
				
			</ui:decorate>
				
		</ui:define>


	</ui:composition>

</h:body>

</html>