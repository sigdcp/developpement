<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:f="http://java.sun.com/jsf/core">
<body>
	<ui:composition>
		
		<p:messages for="dt" />
		<p:dataTable id="dt" value="#{uploader.collection}" var="dto" rowIndexVar="index">
			<f:facet name="header">Pièces justificatives</f:facet>
			 <p:column headerText="Type Pièce">
				<h:outputText value="#{dto.piece.model}" />		
			</p:column>
			
			<p:column headerText="Numéro #{dto.editable}">
				<p:inputText  value="#{dto.piece.numero}" required="false" requiredMessage="#{valueRequiredMessage}" rendered="#{dto.editable}"/>
				<h:outputText value="#{dto.piece.numero}" rendered="#{not dto.editable}"/>
			</p:column>
			<p:column headerText="Date d'établissement ">
				<p:calendar value="#{dto.piece.dateEtablissement}" pattern="#{constantResources.datePattern}" required="false" requiredMessage="#{valueRequiredMessage}" rendered="#{dto.editable}"/>
				<h:outputText value="#{dto.piece.dateEtablissement}" rendered="#{not dto.editable}"><f:convertDateTime pattern="#{constantResources.datePattern}"/></h:outputText>
			</p:column>
			<!--
			<p:column headerText="Date d'effet">
				<p:calendar value="#{dto.piece.dateEffetDecision}" pattern="#{constantResources.datePattern}" required="false" requiredMessage="#{valueRequiredMessage}" rendered="#{dto.editable}"/>	
				<h:outputText value="#{dto.piece.dateEffetDecision}" rendered="#{not editable}"><f:convertDateTime pattern="#{constantResources.datePattern}"/></h:outputText>
			</p:column>
			-->
			<p:column headerText="Fonction du signataire">
				<p:inputText value="#{dto.piece.fonctionSignataire}" required="false" requiredMessage="#{valueRequiredMessage}" rendered="#{dto.editable}"/>
				<h:outputText value="#{dto.piece.fonctionSignataire}" rendered="#{not dto.editable}"/>	
			</p:column>
			
			<p:column headerText="Fichier">
				<p:fileUpload value="#{dto.file}" id="fichier#{index}" mode="simple" required="false" requiredMessage="#{valueRequiredMessage}" rendered="#{dto.editable}"/>
				<p:commandButton value="Voir" icon="ui-icon-search" rendered="#{not dto.editable}" oncomplete="PF('imageDialog').show();" update="@form:display @form:imageDialogHeader">
					<f:setPropertyActionListener value="#{dto.piece}" target="#{controller.pieceJustificativeSelectionne}" />
				</p:commandButton>
			</p:column>
		</p:dataTable>	
					
		<p:dialog widgetVar="imageDialog" modal="true" appendTo="@(Body)" >
		    <f:facet name="header"><p:outputPanel id="imageDialogHeader">
		    	<h:outputText value="#{controller.pieceJustificativeSelectionne.model.typePieceJustificative}" />
		    	<h:outputText value=" N° #{controller.pieceJustificativeSelectionne.numero}" />
		    	<h:outputText value=" du #{controller.pieceJustificativeSelectionne.dateEtablissement}" >
		    		<f:convertDateTime pattern="#{constantResources.datePattern}"/>
		    	</h:outputText>
		    	<h:outputText value=" Signé par #{controller.pieceJustificativeSelectionne.fonctionSignataire}" />
		    </p:outputPanel></f:facet>
		    <p:outputPanel id="display" >  
				<p:graphicImage value="/_fichier_/?id=#{controller.pieceJustificativeSelectionne.fichier.id}" width="900" height="650" />
      		</p:outputPanel>
		</p:dialog>
		
	</ui:composition>
</body>
</html>
